<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ECPriceResearch Test</title>
    <style>
        body {
            font-family: Arial;
            padding: 30px;
            background: #fafafa;
        }
        .search-box {
            margin-bottom: 20px;
        }
        input {
            width: 300px;
            padding: 8px;
            font-size: 16px;
        }
        button {
            padding: 8px 14px;
            font-size: 15px;
            margin-left: 6px;
            cursor: pointer;
        }
        .toggle-btn {
            background: #333;
            color: white;
            border: none;
        }
        h2 {
            margin-top: 30px;
        }
        .platform-box {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        .platform-title {
            font-size: 20px;
            font-weight: bold;
        }
        .item-img {
            width: 150px;
            margin-top: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<h1 id="title">ğŸ“¦ ECPriceResearch ê°€ê²© ë¹„êµ í…ŒìŠ¤íŠ¸</h1>

<button class="toggle-btn" onclick="toggleLang()">ğŸŒ ì–¸ì–´ ì „í™˜</button>

<div class="search-box">
    <label id="labelKeyword">ê²€ìƒ‰ í‚¤ì›Œë“œ</label><br>
    <input id="keyword" placeholder="ì˜ˆ: ì•„ì´í° 13">
    <button onclick="fetchMargin()">ğŸš€ ì¡°íšŒ</button>
</div>

<h2 id="resultTitle">ê²°ê³¼</h2>

<div id="result">ì•„ì§ ì¡°íšŒ ì•ˆí•¨</div>

<script>
    let lang = "ko";

    const words = {
        ko: {
            title: "ğŸ“¦ ECPriceResearch ê°€ê²© ë¹„êµ í…ŒìŠ¤íŠ¸",
            keywordLabel: "ê²€ìƒ‰ í‚¤ì›Œë“œ",
            placeholder: "ì˜ˆ: ì•„ì´í° 13",
            search: "ğŸš€ ì¡°íšŒ",
            result: "ê²°ê³¼",
            noData: "ìƒí’ˆ ì—†ìŒ"
        },
        jp: {
            title: "ğŸ“¦ ECPriceResearch ä¾¡æ ¼æ¯”è¼ƒãƒ†ã‚¹ãƒˆ",
            keywordLabel: "æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰",
            placeholder: "ä¾‹ï¼š iPhone 13",
            search: "ğŸš€ æ¤œç´¢",
            result: "çµæœ",
            noData: "ãƒ‡ãƒ¼ã‚¿ãªã—"
        }
    };

    function toggleLang() {
        lang = lang === "ko" ? "jp" : "ko";

        document.getElementById("title").textContent = words[lang].title;
        document.getElementById("labelKeyword").textContent = words[lang].keywordLabel;
        document.getElementById("keyword").placeholder = words[lang].placeholder;
        document.getElementById("resultTitle").textContent = words[lang].result;
    }

    async function fetchMargin() {
        const keyword = document.getElementById("keyword").value;

        if (!keyword) {
            alert("í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        const res = await fetch(`/api/margin/compare?keyword=` + encodeURIComponent(keyword));
        const json = await res.json();

        renderResult(json);
    }

    function renderResult(data) {
        const result = document.getElementById("result");

        const platforms = [
            { key: "amazonJp", name: "Amazon Japan" },
            { key: "rakuten", name: "Rakuten" },
            { key: "naver", name: "Naver Shopping" },
            { key: "coupang", name: "Coupang" }
        ];

        let html = "";

        platforms.forEach(p => {
            let item = data[p.key];

            html += `
                <div class="platform-box">
                    <div class="platform-title">${p.name}</div>
                    ${item.productImage ? `<img class="item-img" src="${item.productImage}">` : ""}
                    <p><b>ìƒí’ˆëª…:</b> ${item.productName}</p>
                    <p><b>ê°€ê²©:</b> ${item.priceOriginal.toLocaleString()} ${item.currencyOriginal}</p>
                    <p><b>URL:</b> <a href="${item.productUrl}" target="_blank">ë°”ë¡œê°€ê¸°</a></p>
                </div>
            `;
        });

        result.innerHTML = html;
    }
</script>

</body>
</html>
