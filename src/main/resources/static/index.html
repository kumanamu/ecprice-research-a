<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>ECPriceResearch Premium</title>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"/>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f6f7f9;
            margin: 0;
            padding: 0;
        }
        .container { max-width: 1080px; margin:auto; padding:20px; }
        .title { font-size:28px; font-weight:700; margin-bottom:18px; }

        .search-area { display:flex; gap:10px; margin-bottom:15px; }

        input {
            padding:12px 15px;
            font-size:16px;
            width:350px;
            border-radius:8px;
            border:1px solid #ccc;
        }

        button {
            padding:10px 20px;
            border:none; border-radius:8px;
            background:#444; color:white;
            cursor:pointer;
            font-size:15px;
        }

        .toggle {
            padding:6px 14px;
            border-radius:8px;
            border:1px solid #aaa;
            background:white;
            font-size:14px;
            cursor:pointer;
        }
        .toggle.active {
            background:#222; color:#fff; border-color:#222;
        }

        .platform-grid {
            display:grid;
            grid-template-columns: repeat(3, 1fr);
            gap:18px; margin-top:25px;
        }

        .card {
            background:white;
            border-radius:12px;
            padding:15px;
            min-height:150px;
            box-shadow:0 2px 6px rgba(0,0,0,0.08);
        }

        .price { font-size:20px; font-weight:700; color:#ff6f3c; }

        .summary-box, .ai-box {
            background:white; border-radius:15px;
            padding:20px; margin-top:30px;
            box-shadow:0 2px 8px rgba(0,0,0,0.08);
        }
    </style>
</head>

<body>
<div class="container">

    <div class="title">ğŸ“¦ ECPriceResearch Premium</div>

    <div style="display:flex; gap:8px; margin-bottom:12px;">
        <button id="lang-toggle" class="toggle active" data-lang="ko">
            ğŸ‡°ğŸ‡· í•œêµ­ì–´ / ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª
        </button>
        <button id="mode-toggle" class="toggle active" data-mode="basic">
            âš¡ Basic / Premium
        </button>
    </div>

    <div class="search-area">
        <input id="keyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ ì˜ˆ: adidas samba"/>
        <button id="searchBtn">ì¡°íšŒ</button>
    </div>

    <h3>ê²°ê³¼</h3>

    <div id="platforms" class="platform-grid">
        <div class="card" id="amazonJp"></div>
        <div class="card" id="rakuten"></div>
        <div class="card" id="naver"></div>
        <div class="card" id="coupang"></div>
    </div>

    <div class="summary-box">
        <b>ğŸ’° ê°€ê²© ìš”ì•½</b><br>
        <div id="summary"></div>
    </div>

    <div class="ai-box">
        <b>ğŸ¤– AI ë¶„ì„</b><br>
        <div id="ai"></div>
    </div>

</div>

<script>

    document.getElementById("searchBtn").onclick = search;
    document.getElementById("mode-toggle").onclick = toggleMode;
    document.getElementById("lang-toggle").onclick = toggleLang;

    let lastResult = null;

    /** ì–¸ì–´ í† ê¸€ */
    function toggleLang() {
        const btn = document.getElementById("lang-toggle");
        btn.dataset.lang = (btn.dataset.lang === "ko" ? "jp" : "ko");
        btn.classList.toggle("active");
    }

    /** Basic / Premium í† ê¸€ */
    function toggleMode() {
        const btn = document.getElementById("mode-toggle");
        const current = btn.dataset.mode;

        btn.dataset.mode = (current === "basic" ? "premium" : "basic");
        btn.classList.toggle("active");

        if (lastResult) renderAi(lastResult);
    }

    /** ê²€ìƒ‰ */
    async function search() {
        const keyword = document.getElementById("keyword").value.trim();
        const lang = document.getElementById("lang-toggle").dataset.lang;
        const mode = document.getElementById("mode-toggle").dataset.mode;

        try {
            const res = await fetch(
                `/api/margin?keyword=${encodeURIComponent(keyword)}&lang=${lang}&premium=${mode === "premium"}`
            );

            const data = await res.json();

            lastResult = data;
            renderAll(data);

        } catch (e) { console.error(e); }
    }

    /** ì „ì²´ ë Œë” */
    function renderAll(data) {
        if (!data || !data.platformPrices) return;

        renderPlatform("amazonJp", data.platformPrices.amazonJp);
        renderPlatform("rakuten", data.platformPrices.rakuten);
        renderPlatform("naver", data.platformPrices.naver);
        renderPlatform("coupang", data.platformPrices.coupang);

        renderSummary(data);
        renderAi(data);
    }

    /** í”Œë«í¼ ì¹´ë“œ ë Œë” */
    function renderPlatform(id, info) {
        const div = document.getElementById(id);

        if (!info) {
            div.innerHTML = "<b>ë°ì´í„° ì—†ìŒ</b>";
            return;
        }

        div.innerHTML = `
            <b>${id}</b><br>
            <span class="price">${info.priceKrw ?? "N/A"} KRW</span><br>
            (${info.priceJpy ?? "N/A"} JPY)<br>
            <a href="${info.productUrl || "#"}" target="_blank">ìƒí’ˆ ë³´ê¸° â†’</a>
        `;
    }

    /** ê°€ê²© ìš”ì•½ */
    function renderSummary(data) {
        document.getElementById("summary").innerHTML = `
            ìµœì €ê°€ í”Œë«í¼: ${data.bestPlatform}<br>
            ìµœì €ê°€ ê¸ˆì•¡: ${data.profitKrw} KRW
        `;
    }

    /** Basic / Premium AI ë¶„ì„ */
    function renderAi(data) {
        const mode = document.getElementById("mode-toggle").dataset.mode;

        let aiText = "AI ì¤€ë¹„ ì¤‘â€¦";

        if (mode === "basic" && data.basicAi)
            aiText = data.basicAi.text;

        if (mode === "premium" && data.premiumAi)
            aiText = data.premiumAi.text;

        document.getElementById("ai").innerHTML =
            `<pre style="white-space: pre-wrap; font-size:17px; line-height:1.45;">${aiText}</pre>`;
    }

</script>

</body>
</html>
