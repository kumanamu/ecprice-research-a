<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>ECPriceResearch Premium</title>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f6f7f9;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1080px;
            margin: auto;
            padding: 20px;
        }
        .title {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            margin-bottom: 18px;
        }
        .search-area {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        input {
            padding: 12px 15px;
            font-size: 16px;
            width: 350px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        button {
            padding: 10px 20px;
            font-size: 15px;
            border-radius: 8px;
            border: none;
            background: #444;
            color: white;
            cursor: pointer;
        }
        .toggle {
            padding: 6px 14px;
            border-radius: 8px;
            border: 1px solid #aaa;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }
        .toggle.active {
            background: #222;
            color: #fff;
            border-color: #222;
        }
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin-top: 25px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            min-height: 150px;
        }
        .price {
            font-size: 20px;
            font-weight: 700;
            color: #ff6f3c;
            margin: 5px 0;
        }
        .summary-box, .ai-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
    </style>
</head>

<body>
<div class="container">

    <div class="title">üì¶ ECPriceResearch Premium</div>

    <div style="display:flex; gap:8px; margin-bottom: 12px;">
        <button id="lang-toggle" class="toggle active" data-lang="ko">
            üá∞üá∑ ÌïúÍµ≠Ïñ¥ / üáØüáµ ÏùºÎ≥∏Ë™û
        </button>
        <button id="mode-toggle" class="toggle active" data-mode="basic">
            ‚ö° Basic / Premium
        </button>
    </div>

    <div class="search-area">
        <input id="keyword" placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• Ïòà: adidas samba" />
        <button id="searchBtn">Ï°∞Ìöå</button>
    </div>

    <h3>Í≤∞Í≥º</h3>

    <div id="platforms" class="platform-grid">
        <div class="card" id="amazonJp"></div>
        <div class="card" id="rakuten"></div>
        <div class="card" id="naver"></div>
        <div class="card" id="coupang"></div>
    </div>

    <div class="summary-box" id="summaryBox">
        <b>üí∞ Í∞ÄÍ≤© ÏöîÏïΩ</b><br>
        <div id="summary"></div>
    </div>

    <div class="ai-box" id="aiBox">
        <b>ü§ñ AI Î∂ÑÏÑù</b><br>
        <div id="ai"></div>
    </div>

</div>

<script>

    document.getElementById("searchBtn").onclick = search;

    document.getElementById("mode-toggle").onclick = function () {
        this.dataset.mode = (this.dataset.mode === "basic" ? "premium" : "basic");
        this.classList.toggle("active");
        if (lastResult) renderAi(lastResult);
    };

    document.getElementById("lang-toggle").onclick = function () {
        this.dataset.lang = (this.dataset.lang === "ko" ? "jp" : "ko");
        this.classList.toggle("active");
    };


    let lastResult = null;


    function search() {
        const keyword = document.getElementById("keyword").value.trim();
        if (!keyword) return alert("Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");

        const lang = document.getElementById("lang-toggle").dataset.lang;

        const encodedKeyword = encodeURIComponent(keyword);
        const encodedLang = encodeURIComponent(lang);

        console.log("üì° API Ìò∏Ï∂ú:", `/api/margin/compare?keyword=${encodedKeyword}&lang=${encodedLang}`);

        fetch(`/api/margin/compare?keyword=${encodedKeyword}&lang=${encodedLang}`)
            .then(res => res.json())
            .then(data => {
                console.log("üì• Î∞±ÏóîÎìú ÏùëÎãµ:", data);
                lastResult = data;
                renderAll(data);
            })
            .catch(e => console.error("‚ùå FRONT FETCH ERROR:", e));
    }


    function renderAll(data) {
        if (!data || !data.platformPrices) return;

        renderPlatform("amazonJp", data.platformPrices.amazonJp);
        renderPlatform("rakuten", data.platformPrices.rakuten);
        renderPlatform("naver", data.platformPrices.naver);
        renderPlatform("coupang", data.platformPrices.coupang);

        renderSummary(data);
        renderAi(data);
    }


    function renderPlatform(id, info) {
        const div = document.getElementById(id);

        if (!info) {
            div.innerHTML = "<b>Ï°∞Ìöå Ïã§Ìå®</b>";
            return;
        }

        div.innerHTML = `
            <b>${id}</b><br>
            <span class="price">${info.priceKrw} KRW</span><br>
            (${info.priceJpy} JPY)<br>
            <a href="${info.productUrl || '#'}" target="_blank">ÏÉÅÌíà Î≥¥Í∏∞ ‚Üí</a>
        `;
    }


    function renderSummary(data) {
        document.getElementById("summary").innerHTML = `
            ÏµúÏ†ÄÍ∞Ä ÌîåÎû´Ìèº: ${data.bestPlatform}<br>
            ÏµúÏ†ÄÍ∞Ä Í∏àÏï°: ${data.profitKrw} KRW
        `;
    }


    function renderAi(data) {
        const mode = document.getElementById("mode-toggle").dataset.mode;

        let aiText = "AI Ï§ÄÎπÑ Ï§ë‚Ä¶";

        if (mode === "basic" && data.basicAi) aiText = data.basicAi.text;
        if (mode === "premium" && data.premiumAi) aiText = data.premiumAi.text;

        document.getElementById("ai").innerHTML =
            `<pre style="white-space: pre-wrap; font-size:17px; line-height:1.45;">${aiText}</pre>`;
    }

</script>

</body>
</html>
