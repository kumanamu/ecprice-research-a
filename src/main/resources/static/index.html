<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ECPriceResearch Test</title>
    <style>
        body { font-family: Arial; padding: 30px; background: #fafafa; }
        .platform-box {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
            display: inline-block;
            margin-right: 20px;
            vertical-align: top;
            width: 250px;
        }
        .ai-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #e0c873;
        }
        .summary {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .price { font-size: 18px; font-weight: bold; color: #e74c3c; margin: 10px 0; }
        .item-img { width: 120px; margin-bottom: 10px; border-radius: 8px; }
    </style>
</head>

<body>

<h1 id="title">ğŸ”¦ ECPriceResearch ê°€ê²© ë¹„êµ</h1>

<button class="toggle-btn" onclick="toggleLang()">ğŸŒ í•œêµ­ì–´ / æ—¥æœ¬èª</button>

<div class="search-box">
    <label id="labelKeyword">ê²€ìƒ‰ í‚¤ì›Œë“œ</label><br>
    <input id="keyword" placeholder="ì˜ˆ: ì•„ì´í° 13">
    <button onclick="fetchMargin()">ğŸš€ ì¡°íšŒ</button>
</div>

<h2 id="resultTitle">ê²°ê³¼</h2>
<div id="result">ì•„ì§ ì¡°íšŒ ì•ˆí•¨</div>


<script>
    let lang = "ko";

    function toggleLang() {
        lang = (lang === "ko") ? "jp" : "ko";

        if (lang === "ko") {
            document.querySelector(".toggle-btn").textContent = "ğŸŒ í•œêµ­ì–´ / æ—¥æœ¬èª";
            document.getElementById("title").textContent = "ğŸ”¦ ECPriceResearch ê°€ê²© ë¹„êµ";
            document.getElementById("labelKeyword").textContent = "ê²€ìƒ‰ í‚¤ì›Œë“œ";
            document.getElementById("keyword").placeholder = "ì˜ˆ: ì•„ì´í° 13";
            document.getElementById("resultTitle").textContent = "ê²°ê³¼";
        } else {
            document.querySelector(".toggle-btn").textContent = "ğŸŒ æ—¥æœ¬èª / í•œêµ­ì–´";
            document.getElementById("title").textContent = "ğŸ”¦ ECPriceResearch ä¾¡æ ¼æ¯”è¼ƒ";
            document.getElementById("labelKeyword").textContent = "æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰";
            document.getElementById("keyword").placeholder = "ä¾‹: iPhone 13";
            document.getElementById("resultTitle").textContent = "çµæœ";
        }
    }


    async function fetchMargin() {
        const keyword = document.getElementById("keyword").value;
        if (!keyword) return alert("í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");

        const box = document.getElementById("result");
        box.innerHTML = "<p>â³ ì¡°íšŒ ì¤‘...</p>";

        try {
            const res = await fetch(
                `/api/margin/compare?keyword=${encodeURIComponent(keyword)}&lang=${lang}`
            );
            if (!res.ok) throw new Error("API Error");

            const json = await res.json();
            renderResult(json);

        } catch (e) {
            box.innerHTML = "<p style='color:red;'>âŒ ì¡°íšŒ ì‹¤íŒ¨</p>";
        }
    }


    function renderResult(data) {
        const box = document.getElementById("result");
        box.innerHTML = "";

        const platformList = [
            { key: "amazonJp", name: "Amazon JP", flag: "ğŸ‡¯ğŸ‡µ" },
            { key: "rakuten", name: "Rakuten", flag: "ğŸ‡¯ğŸ‡µ" },
            { key: "naver",   name: "Naver",   flag: "ğŸ‡°ğŸ‡·" },
            { key: "coupang", name: "Coupang", flag: "ğŸ‡°ğŸ‡·" }
        ];

        let html = "";

        platformList.forEach(p => {
            const item = data[p.key];
            if (!item) return;

            // ë©”ì¸/ì„œë¸Œ ê°€ê²©
            const mainPrice  = lang === "ko" ? item.priceKrw : item.priceJpy;
            const subPrice   = lang === "ko" ? item.priceJpy : item.priceKrw;
            const mainCur    = lang === "ko" ? "KRW" : "JPY";
            const subCur     = lang === "ko" ? "JPY" : "KRW";

            html += `
                <div class="platform-box">
                    <div class="platform-title">${p.flag} ${p.name}</div>
                    <img src="${item.productImage}" class="item-img"
                         onerror="this.src='https://via.placeholder.com/120'"/>
                    <div>${item.productName}</div>
                    <div class="price">${mainPrice.toLocaleString()} ${mainCur}</div>
                    <div style="font-size:12px; color:#666;">
                        ì°¸ê³ : ${subPrice.toLocaleString()} ${subCur}
                    </div>
                    <a href="${item.productUrl}" target="_blank">ìƒí’ˆ ë³´ê¸° â†’</a>
                </div>
            `;
        });


        // ğŸ§® ê°€ê²© ìš”ì•½
        html += `
            <div class="summary">
                <h3>ğŸ’° ê°€ê²© ìš”ì•½</h3>
                <p><strong>ìµœì €ê°€ í”Œë«í¼:</strong> ${data.bestPlatform}</p>
                <p><strong>ìµœì €ê°€:</strong> ${
                    lang === "ko"
                        ? data.profitKrw.toLocaleString() + " KRW (ì°¸ê³ : " + data.profitJpy + " JPY)"
                        : data.profitJpy + " JPY (å‚è€ƒ: " + data.profitKrw.toLocaleString() + " KRW)"
                }</p>
                <p><strong>í™˜ìœ¨:</strong> 1 JPY = ${data.jpyToKrw.toFixed(2)} KRW</p>
            </div>
        `;


        // ğŸ¤– AI ìë™ ë§ˆì§„ ë°•ìŠ¤
        html += `
            <div class="ai-box">
                <h3>ğŸ¤– AI ìë™ ë§ˆì§„ ì‹œë®¬ë ˆì´ì…˜</h3>
                <p><strong>êµ¬ë§¤ê°€:</strong> ${data.autoBuyPrice.toLocaleString()} KRW</p>
                <p><strong>ì¶”ì²œ íŒë§¤ê°€:</strong> ${data.autoSellPrice.toLocaleString()} KRW</p>
                <p><strong>ì¶”ì • ë§ˆì§„:</strong> ${data.autoProfit.toLocaleString()} KRW</p>
                <p><strong>ë§ˆì§„ìœ¨:</strong> ${data.autoProfitRate.toFixed(2)}%</p>

                <h4 style="margin-top:10px;">ğŸ“˜ AI ì „ëµ ìš”ì•½</h4>
                <pre style="white-space:pre-wrap; background:white; padding:10px; border-radius:8px;">
${data.aiStrategy}
                </pre>
            </div>
        `;

        box.innerHTML = html;
    }

</script>

</body>
</html>
