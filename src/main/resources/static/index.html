<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>EC Price Research</title>

    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f6f7f9;
            font-family: 'Inter', sans-serif;
        }

        .top-area {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input, select, button {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .item-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }

        .item-card img {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            object-fit: cover;
        }

        .ai-box {
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            white-space: pre-line;
        }
    </style>
</head>

<body>

<h2>EC Price Research</h2>

<div class="top-area">
    <select id="lang">
        <option value="kr">한국어</option>
        <option value="jp">日本語</option>
    </select>

    <select id="ai-mode">
        <option value="basic">Basic AI</option>
        <option value="premium">Premium AI</option>
    </select>

    <input id="keyword" placeholder="검색어 입력" />
    <button onclick="search()">검색</button>
</div>

<div id="result"></div>

<div id="ai-result" class="ai-box"></div>

<script>
    let last = null;

    document.getElementById("keyword").addEventListener("keydown", e => {
        if (e.key === "Enter") search();
    });

    function search() {
        const k = document.getElementById("keyword").value;
        const lang = document.getElementById("lang").value;

        if (!k.trim()) {
            alert("검색어 입력하세요");
            return;
        }

        fetch(`/api/margin/compare?keyword=${k}&lang=${lang}`)
            .then(r => r.json())
            .then(data => {
                last = data;
                renderList(data);
                renderAI();
            });
    }

    document.getElementById("ai-mode").addEventListener("change", renderAI);

    function renderList(data) {
        const box = document.getElementById("result");
        box.innerHTML = "";

        const arr = [
            data.amazon,
            data.rakuten,
            data.naver,
            data.coupang
        ];

        arr.forEach(it => {
            if (!it) return;

            box.innerHTML += `
                <div class="item-card">
                    <img src="${it.productImage ?? ''}" alt="">
                    <div>
                        <div><b>${it.platform}</b></div>
                        <div>${it.productName ?? ''}</div>
                        <div>${it.priceKrw ?? ''} KRW</div>
                    </div>
                </div>
            `;
        });
    }

    function renderAI() {
        if (!last) return;

        const mode = document.getElementById("ai-mode").value;
        const aiBox = document.getElementById("ai-result");

        aiBox.innerText =
            mode === "premium"
                ? last.premiumAi?.text ?? ""
                : last.basicAi?.text ?? "";
    }
</script>

</body>
</html>
